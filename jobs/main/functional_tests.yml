<%include file="trigger_defaults.yml"/>
<%include file="default.yml"/>

job_description: Functional tests
numOfJobsToKeep: 10
daysToKeep: 7
buildParams:
  - paramName: BranchName
    paramValue: ""
    paramDesc:  "Temporary branch name in internal repository"
    paramType: string
  - paramName: PrivateRepo
    paramValue: "git@github.com:dimtruck/workshop_demo.git"
    paramDesc:  Private repository (Solum specific)
    paramType: string
scm:
  gitURL: "https://github.com/dimtruck/workshop_deployment"
  gitBranch: "*/master"
  extensions: 
    cleanbeforecheckout: True
virtualenvBuilder:
  command: |
           <%text>#!/bin/bash
           pip install -r ~/ansible-requirements.txt
           . ~/.profile
           export ANSIBLE_FORCE_COLOR=true ANSIBLE_HOST_KEY_CHECKING=false \
           ANSIBLE_SSH_ARGS='-o UserKnownHostsFile=/dev/null -o ControlMaster=auto -o ControlPersist=60s -o PubkeyAuthentication=yes'

           ansible-playbook deploy.yml -i inventory/functional/ \
           --tags "blue-nodes,blue-lb,deploy,purge" \
           --private-key ~/.ssh/id_rsa \
           --extra-vars "branch=${BranchName} repo=${PrivateRepo} group_environ=${BranchName}-functional"

           </%text>
shell_build_command: 
  - build: |
           #!/bin/bash
           # run selenium here
junitArchiver:
  testResults: "**/results.xml"
  keepLongStdio: False
